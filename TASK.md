# Технический стек проекта 2D-симулятора ПЛК с OPC UA

## 1. Язык и архитектура
**Язык:** C++20/23  
**Архитектура:** модульная, ECS (Entity Component System), главный игровой поток + отдельный поток для OPC UA + поток физики.

## 2. Рендеринг, ввод, аудио

### SFML 3 + Thor
**Назначение:**
- Окно, управление контекстом
- 2D-рендер графики (тайлы, спрайты, объекты)
- Работа с текстурами, спрайт-атласами
- Базовое аудио (UI звуки)
- Ввод: клавиатура, мышь
- Thor: система частиц, расширенная анимация

**Плюсы:** простой API, идеально подходит для 2D, расширяемость через Thor.

### OpenAL Soft (опционально)
**Назначение:**
- 3D позиционирование звука
- Реалистичные промышленные звуки
- Динамическое микширование по расстоянию

## 3. Физика и симуляция

### Box2D
**Назначение:**
- Физика твердых тел для механизмов
- Симуляция конвейеров, падения предметов
- Детекция столкновений для датчиков
- Упрощенная симуляция жидкостей

**Плюсы:** промышленный стандарт 2D физики, стабильность.

## 4. ECS (Entity Component System)

### EnTT
**Назначение:**
- Управление сущностями (тайлы, механизмы, UI)
- Системы: рендер, физика, логика, обновления от OPC UA

**Компоненты для промышленной симуляции:**
- `Transform` - позиция, поворот, масштаб
- `Sprite` - визуальное представление
- `SensorComponent` - тип датчика, диапазон, текущее значение
- `ActuatorComponent` - тип актуатора, состояние
- `ConveyorComponent` - скорость, направление
- `TankComponent` - объем, уровень, тип жидкости
- `PLCBindingComponent` - OPC UA NodeId, тип связи, масштабирование
- `ElectricalComponent` - напряжение, ток, мощность
- `PneumaticComponent` - давление, поток
- `State` - состояние объекта
- `Animation` - параметры анимации

**Плюсы:** высокая производительность, чистый C++, header-only.

## 5. Работа с картами и тайлами

### tmxlite
**Назначение:**
- Загрузка карт TMX (Tiled)
- Получение слоёв, тайлсетов, объектов
- Поддержка метаданных для физических свойств
- Многослойность: пол, оборудование, трубы, провода

**Дополнительно:**
- Автотайлинг для труб и конвейеров
- Метаданные тайлов для типов поверхностей

**Плюсы:** лёгкая, гибкая библиотека для TMX.

## 6. OPC UA и промышленные протоколы

### open62541 + open62541pp
**Назначение:**
- OPC UA клиент/сервер
- Чтение/запись переменных
- Подписки на изменения
- Браузинг адресного пространства
- C++ обёртка для удобства

**Плюсы:** open-source промышленный стек, отличная совместимость с ПЛК.

### libmodbus (опционально)
**Назначение:**
- Поддержка Modbus TCP/RTU
- Расширение совместимости с ПЛК

## 7. Система сигналов и событий

### boost::signals2
**Назначение:**
- Связывание OPC UA переменных с игровыми объектами
- Событийная архитектура для датчиков и актуаторов
- Цепочки реакций между компонентами
- Развязка модулей системы

**Плюсы:** thread-safe, гибкая система подписок.

## 8. Скриптовая система

### Lua + sol2
**Назначение:**
- Скрипты поведения объектов
- Пользовательская логика автоматизации
- Реакции на изменения переменных OPC UA
- Создание сценариев обучения

**Плюсы:** минимальный overhead, простая интеграция, популярность в геймдеве.

## 9. UI и инструменты

### Dear ImGui + ImPlot
**Назначение:**
- Отладочное UI
- Инспекция объектов и компонентов
- Привязка PLCBinding через интерфейс
- Браузер OPC UA переменных
- Графики реального времени (ImPlot)
- Тренды сигналов и осциллограммы
- Редактор уровней

**Плюсы:** простая интеграция с SFML, мощная визуализация данных.

## 10. Хранение данных и конфигурации

### SQLite
**Назначение:**
- Сохранение больших проектов
- История изменений
- Библиотека компонентов
- Логирование событий симуляции

### yaml-cpp
**Назначение:**
- Человекочитаемые конфигурации
- Настройки симуляции
- Описание промышленных компонентов

### nlohmann/json
**Назначение:**
- Быстрый обмен данными
- Сохранение привязок PLCBinding
- Настройки анимаций
- REST API ответы

## 11. Логирование и форматирование

### spdlog
**Назначение:** 
- Высокоскоростное логирование
- Ротация логов
- Многопоточное логирование
- Уровни важности для промышленной отладки

### fmt
**Назначение:** 
- Быстрое форматирование строк
- Форматирование промышленных данных

## 12. Асинхронность и сеть

### asio (standalone)
**Назначение:**
- Асинхронные таймеры симуляции
- Синхронизация нескольких симуляторов
- REST API для внешнего управления
- Распределенная симуляция
- Поддержка асинхронной логики OPC UA

## 13. Профилирование и отладка

### Tracy Profiler
**Назначение:**
- Профилирование в реальном времени
- Анализ производительности ECS
- Мониторинг потоков
- Визуализация фреймов

### Optick (альтернатива)
**Назначение:**
- Детальное профилирование
- Интеграция с игровым циклом

## 14. Сборка и зависимости

### CMake
**Назначение:** основная система сборки, модульная структура.

### vcpkg (рекомендуется)
**Назначение:** управление зависимостями.

**Устанавливаемые пакеты:**
- SFML, Thor
- EnTT
- Box2D
- tmxlite
- open62541, open62541pp
- Lua, sol2
- boost::signals2
- nlohmann/json, yaml-cpp
- SQLite3
- spdlog, fmt
- asio
- Dear ImGui, ImPlot

## 15. Форматы ассетов
- **Спрайты:** PNG (16x16, 32x32, атласы)
- **Карты:** TMX (Tiled) с метаданными
- **Анимации:** JSON с таймингами
- **Конфигурации:** YAML
- **Скрипты:** Lua
- **Проекты:** SQLite база данных
- **Звуки:** OGG Vorbis

## 16. Тестирование

### Модульные тесты
- Catch2 или GoogleTest
- Тестирование ECS компонентов
- Тестирование физики

### Интеграционные тесты
- Автотесты OPC UA (локальный тестовый сервер)
- Тестирование цепочек автоматизации
- Валидация скриптов Lua

## 17. Документация

### Doxygen
**Назначение:**
- Генерация документации API
- Документация компонентов
- Примеры использования

### Библиотека примеров
- Готовые промышленные компоненты
- Типовые схемы автоматизации
- Шаблоны проектов

## 18. Итоговый стек (кратко)

### Ядро:
- **C++20/23**
- **SFML 3 + Thor**
- **EnTT**
- **Box2D**
- **open62541 + open62541pp**

### Данные:
- **SQLite** (проекты)
- **yaml-cpp** (конфиги)
- **nlohmann/json** (обмен)
- **tmxlite** (карты)

### Логика и UI:
- **Lua + sol2**
- **Dear ImGui + ImPlot**
- **boost::signals2**

### Инфраструктура:
- **spdlog + fmt**
- **asio**
- **Tracy Profiler**
- **CMake + vcpkg**

### Опционально:
- **OpenAL Soft** (продвинутое аудио)
- **libmodbus** (Modbus протокол)
- **Doxygen** (документация)

### Инструменты разработки:
- **Tiled Map Editor** (создание карт)
- **Aseprite** (пиксель-арт)
- **CLion / Visual Studio / VS Code** (IDE)
- **CODESYS** (тестовые ПЛК)

## 19. Особенности архитектуры

### Потоки выполнения:
1. **Главный поток** - рендеринг, UI, ввод
2. **Поток физики** - Box2D симуляция
3. **Поток OPC UA** - коммуникация с ПЛК
4. **Поток скриптов** - выполнение Lua (опционально)

### Паттерны:
- **ECS** - основная архитектура
- **Observer** - события через signals2
- **Command** - для undo/redo в редакторе
- **Factory** - создание промышленных компонентов
- **State Machine** - логика оборудования

### Модули системы:
- **Core** - базовая функциональность
- **Simulation** - физика и логика
- **Rendering** - визуализация
- **Industrial** - промышленные протоколы
- **Scripting** - Lua интеграция
- **Editor** - инструменты редактирования
- **UI** - пользовательский интерфейс